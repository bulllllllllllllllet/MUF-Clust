**已实现内容**
- 在 `segmentation.py` 接入“DAPI-only 细胞区域识别（3.2 固定半径法 + Voronoi）”，沿用现有 tile/坐标体系与输出约定：
  - 新增 ROI 常量：`ROI_SCALE=1.8`、`ROI_NEAREST_LIMIT=0.6`，用于控制膨胀半径与最近邻限制。
  - 新增函数：`_build_cell_roi_from_props` 在 `src/muf_clust/core/steps/segmentation.py:297-356`。
    - 估计核等效半径 `r_nuc = sqrt(area/pi)`。
    - 每细胞半径 `R = min(ROI_SCALE*r_nuc, ROI_NEAREST_LIMIT*最近邻距离)`。
    - 在每个核的圆盘范围内做“限制 Voronoi”分配，像素归属最近的核质心；返回标签图。
  - 在 tile 循环中生成并保存 ROI：
    - 位置：`src/muf_clust/core/steps/segmentation.py:261-277`。
    - 输出两类图：
      - `roi_{x}_{y}.png`：ROI 二值掩码
      - `roi_label_{x}_{y}.png`：ROI 标签图（保持每个细胞唯一标签）
  - 输出目录增加 `roi_tiles_dir`：
    - 位置：`src/muf_clust/core/steps/segmentation.py:194-202` 和返回的路径 `src/muf_clust/core/steps/segmentation.py:121-133`。

**关键代码参考**
- ROI 构造函数定义：`src/muf_clust/core/steps/segmentation.py:297-356`
- ROI 保存：`src/muf_clust/core/steps/segmentation.py:261-277`
- 运行主流程更新：`SegmentationStep.run` 在 `src/muf_clust/core/steps/segmentation.py:113-133`
- 目录准备：`_prepare_output_dirs` 在 `src/muf_clust/core/steps/segmentation.py:194-202`

**行为说明**
- 输入仍为 DAPI；先通过 Cellpose `nuclei` 获取核标签图与 `regionprops`。
- 对每个核计算近似细胞半径，限制在最近邻距离的比例之内，避免在高密度区域过度扩张。
- 使用限制 Voronoi 分配保证重叠像素唯一归属，符合指南“重叠>30%时采用 Voronoi”的精神。
- 产物与原有核分割对齐：tile 坐标一致，标签图与二值图并存，便于后续 3.3 强度统计对 ROI 聚合。

**验证简述**
- 导入检查：模块中存在 `_build_cell_roi_from_props` 且可调用。
- 简单合成 props 测试返回标签图，含 `0`（背景）和各细胞标签，形状正确。

**参数建议**
- `ROI_SCALE`：
  - 免疫细胞可用 1.4–1.8；上皮细胞可用 1.8–2.5。
- `ROI_NEAREST_LIMIT`：0.6–0.8，越大越容易重叠，越小越保守。
- 若你需要可配置化，我可以把这两个参数暴露到 CLI/context 并写入日志。

**下一步可选**
- 将 ROI 标签与核标签进行 ID 对齐汇总，写出一个每细胞的记录表（质心、核面积、ROI面积）。
- 将 3.3 的强度统计接入：对每个非 DAPI 通道按 `roi_label` 聚合像素，输出 `N × C` 特征矩阵。
- 增加 QC 图：`roi_bg_boxplot_{ch}.png` 与 `per_channel_hist_{ch}.png`。

如果你希望把参数改为可调或立即接入 3.3 的强度统计，我可以继续实现并提供使用示例命令。